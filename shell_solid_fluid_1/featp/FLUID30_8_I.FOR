
	SUBROUTINE FLUID30_8_I(XY,X,Y,Z,FK,FM,FSQQ)
	USE IMSL
      IMPLICIT  REAL* 8 (A-H, O-Z)
	COMMON  DENS,SONC
      DIMENSION   FXY(8,3),VN(8),VNN(3,24),VDN(3,8),VJJ(3,3),VJ(3,3),
     $          VD(3,8),FK(8,8),FM(8,8),FN(3),FN1(3),FN2(3),FSQQ(8,24),
     $          FSQ(8,3),XY(8,3)
C***************计算Fluid30单元的刚度、质量矩阵***********************
!===============Fluid30八节点单元的形函数==================
	VN(1)=(1.0-X)*(1.0-Y)*(1.0-Z)*0.125
	VN(2)=(1.0-X)*(1.0+Y)*(1.0-Z)*0.125
	VN(3)=(1.0-X)*(1.0+Y)*(1.0+Z)*0.125
	VN(4)=(1.0-X)*(1.0-Y)*(1.0+Z)*0.125
	VN(5)=(1.0+X)*(1.0-Y)*(1.0-Z)*0.125
	VN(6)=(1.0+X)*(1.0+Y)*(1.0-Z)*0.125
	VN(7)=(1.0+X)*(1.0+Y)*(1.0+Z)*0.125
	VN(8)=(1.0+X)*(1.0-Y)*(1.0+Z)*0.125

!	VN(4)=(1.0-X)*(1.0-Y)*(1.0-Z)*0.125
!	VN(1)=(1.0-X)*(1.0+Y)*(1.0-Z)*0.125
!	VN(2)=(1.0-X)*(1.0+Y)*(1.0+Z)*0.125
!	VN(3)=(1.0-X)*(1.0-Y)*(1.0+Z)*0.125
!	VN(8)=(1.0+X)*(1.0-Y)*(1.0-Z)*0.125
!	VN(5)=(1.0+X)*(1.0+Y)*(1.0-Z)*0.125
!	VN(6)=(1.0+X)*(1.0+Y)*(1.0+Z)*0.125
!	VN(7)=(1.0+X)*(1.0-Y)*(1.0+Z)*0.125
!====================================================
!=========Fluid30八节点单元的形函数对自然坐标的导数========
	VDN(1,1)=-(1.0-Y)*(1.0-Z)*0.125
      VDN(1,2)=-(1.0+Y)*(1.0-Z)*0.125
	VDN(1,3)=-(1.0+Y)*(1.0+Z)*0.125
	VDN(1,4)=-(1.0-Y)*(1.0+Z)*0.125
	VDN(1,5)= (1.0-Y)*(1.0-Z)*0.125
	VDN(1,6)= (1.0+Y)*(1.0-Z)*0.125
	VDN(1,7)= (1.0+Y)*(1.0+Z)*0.125
	VDN(1,8)= (1.0-Y)*(1.0+Z)*0.125

      VDN(2,1)=-(1.0-X)*(1.0-Z)*0.125
      VDN(2,2)= (1.0-X)*(1.0-Z)*0.125
	VDN(2,3)= (1.0-X)*(1.0+Z)*0.125
	VDN(2,4)=-(1.0-X)*(1.0+Z)*0.125
	VDN(2,5)=-(1.0+X)*(1.0-Z)*0.125
	VDN(2,6)= (1.0+X)*(1.0-Z)*0.125
	VDN(2,7)= (1.0+X)*(1.0+Z)*0.125
	VDN(2,8)=-(1.0+X)*(1.0+Z)*0.125

	VDN(3,1)=-(1.0-X)*(1.0-Y)*0.125
      VDN(3,2)=-(1.0-X)*(1.0+Y)*0.125
	VDN(3,3)= (1.0-X)*(1.0+Y)*0.125
	VDN(3,4)= (1.0-X)*(1.0-Y)*0.125
	VDN(3,5)=-(1.0+X)*(1.0-Y)*0.125
	VDN(3,6)=-(1.0+X)*(1.0+Y)*0.125
	VDN(3,7)= (1.0+X)*(1.0+Y)*0.125
	VDN(3,8)= (1.0+X)*(1.0-Y)*0.125

!	VDN(1,4)=-(1.0-Y)*(1.0-Z)*0.125
!      VDN(1,1)=-(1.0+Y)*(1.0-Z)*0.125
!	VDN(1,2)=-(1.0+Y)*(1.0+Z)*0.125
!	VDN(1,3)=-(1.0-Y)*(1.0+Z)*0.125
!	VDN(1,8)= (1.0-Y)*(1.0-Z)*0.125
!	VDN(1,5)= (1.0+Y)*(1.0-Z)*0.125
!	VDN(1,6)= (1.0+Y)*(1.0+Z)*0.125
!	VDN(1,7)= (1.0-Y)*(1.0+Z)*0.125

!      VDN(2,4)=-(1.0-X)*(1.0-Z)*0.125
!      VDN(2,1)= (1.0-X)*(1.0-Z)*0.125
!	VDN(2,2)= (1.0-X)*(1.0+Z)*0.125
!	VDN(2,3)=-(1.0-X)*(1.0+Z)*0.125
!	VDN(2,8)=-(1.0+X)*(1.0-Z)*0.125
!	VDN(2,5)= (1.0+X)*(1.0-Z)*0.125
!	VDN(2,6)= (1.0+X)*(1.0+Z)*0.125
!	VDN(2,7)=-(1.0+X)*(1.0+Z)*0.125

!	VDN(3,4)=-(1.0-X)*(1.0-Y)*0.125
!      VDN(3,1)=-(1.0-X)*(1.0+Y)*0.125
!	VDN(3,2)= (1.0-X)*(1.0+Y)*0.125
!	VDN(3,3)= (1.0-X)*(1.0-Y)*0.125
!	VDN(3,8)=-(1.0+X)*(1.0-Y)*0.125
!	VDN(3,5)=-(1.0+X)*(1.0+Y)*0.125
!	VDN(3,6)= (1.0+X)*(1.0+Y)*0.125
!	VDN(3,7)= (1.0+X)*(1.0-Y)*0.125
!====================================================
!=============计算雅克比矩阵及雅克比行列式===========
	DO 10 I=1,3
	DO 10 J=1,3
	VJJ(I,J)=0.0
	DO 10 K=1,8
      VJJ(I,J)=VJJ(I,J)+VDN(I,K)*XY(K,J) !雅克比矩阵
10    CONTINUE

      SJ8=VJJ(1,1)*(VJJ(2,2)*VJJ(3,3)-VJJ(2,3)*VJJ(3,2))-
     $    VJJ(1,2)*(VJJ(2,1)*VJJ(3,3)-VJJ(2,3)*VJJ(3,1))+
     $    VJJ(1,3)*(VJJ(2,2)*VJJ(3,1)-VJJ(2,1)*VJJ(3,2))  !雅克比行列式
!====================================================
      VJ(:,:)=0.0
	VJ(:,:)=.I.VJJ  !计算雅克比矩阵的逆阵

      DO 11 I=1,3
	DO 11 J=1,8
	VD(I,J)=0.0
      DO 11 K=1,3
      VD(I,J)=VD(I,J)+VJ(I,K)*VDN(K,J)   !形函数对全局坐标的导数
11    CONTINUE
      
      DO 12 I=1,8
	DO 12 J=1,8
      FK(I,J)=0.0
	FM(I,J)=0.0
	FM(I,J)=FM(I,J)+VN(I)*VN(J)*ABS(SJ8)/(SONC*SONC) !(SONC*SONC)!质量矩阵
	DO 12 K=1,3
	FK(I,J)=FK(I,J)+VD(K,I)*VD(K,J)*ABS(SJ8)     !刚度矩阵
12    CONTINUE

!=======================================================
C*******************************************************    
	RETURN
     	END
